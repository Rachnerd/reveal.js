<section style="display: flex; justify-content: center; ; align-items: center">
    <img src="https://miro.medium.com/max/1838/1*pO4kjXdsOi_ZsS50Py6UNQ.png" style="width: 15em;"/>
    <aside class="notes">
        Let's talk frontend for a moment.
    </aside>
</section>

<section style="display: flex; justify-content: center; ; align-items: center">
    <img src="https://www.apollographql.com/docs/apollo-server/ee7fbac9c0ca5b1dd6aef886bb695e63/index-diagram.svg"
         style="width: 15em;"/>
    <aside class="notes">
    </aside>
</section>

<section>
    <h2>Apollo client</h2>
    <div style="display: flex; justify-content: center; align-items: center">

        <div>
            <img src="https://d2eip9sf3oo6c2.cloudfront.net/tags/images/000/001/216/square_480/apollo-seeklogo.com_%281%29.png"
                 style="width: 4em;"/>
        </div>
        <div style="width: 100px;"></div>
        <div>
            <ul>
                <li>React</li>
                <li>Angular</li>
                <li>Vue</li>
                <li>Meteor</li>
            </ul>
        </div>
    </div>
</section>

<section>
    <div>
        <img src="assets/apolloclient.png"/>
    </div>

</section>

<section>
    <h2>Queries</h2>
</section>

<!--React-->
<section>
    <div class="container">
        <div style="flex: 4">
    <pre style="width: 100%;"><code class="hljs typescript" data-trim data-noescape>
    export const ITEM_BY_ID_QUERY = gql`
        query ItemById ($id: Int!) {
              item(id: $id){
                id
                name
              }
        }
    `;
	</code></pre>
        </div>
        <div style="flex: 2; position: relative">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a7/React-icon.svg/1920px-React-icon.svg.png"
                 alt="react"/>
            <img src="https://miro.medium.com/max/816/1*mn6bOs7s6Qbao15PMNRyOA.png" alt="codegen" width="50"
                 style="position: absolute; right: 2em; bottom: 1em;"/>
        </div>
    </div>
    <div class="container fragment">
        <div style="flex: 8" class="container__content">
    <pre style="width: 100%; margin: 0"><code class="hljs typescript" data-trim data-noescape>
        type ItemQuery = Record&lt;"item", Pick&lt;GQLItem, "id" | "name"&gt;>;

        const { data, loading, error } = useQuery&lt;ItemQuery&gt;(ITEM_BY_ID_QUERY, {
            variables: { id: 1 }
        });

        if(loading) {
            return &lt;Loader /&gt;
        } else if(error) {
            return &lt;Apology /&gt;
        } else if(data) {
            const { item: { id, name } } = data;
            // ...
        }
	</code></pre>
        </div>
    </div>
    <aside class="notes">
        TypeScript knows exactly which fields are queried.
    </aside>
</section>
<!--React-->
<section style="z-index: 999;">
    <div class="container">
        <div style="flex: 4">
    <pre style="width: 100%;"><code class="hljs graphql" data-trim data-noescape>
    query <mark>ItemById</mark> ($id: Int!) {
      item(id: $id){
        id
        name
      }
    }
	</code></pre>
        </div>
        <div style="flex: 2">

            <img src="https://graphql-code-generator.com/img/gql-codegen-cover.png" alt="codegen" width="200"/>
        </div>
        <div style="flex: 2; position: relative; padding-right: 2em">

            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a7/React-icon.svg/1920px-React-icon.svg.png"
                 alt="react"/>
            <img src="https://miro.medium.com/max/816/1*mn6bOs7s6Qbao15PMNRyOA.png" alt="codegen" width="30"
                 style="position: absolute; right: 3.4em; bottom: 1em;"/>
        </div>
    </div>
    <div class="container">
        <div style="flex: 8" class="container__content">
    <pre style="width: 100%;"><code class="hljs typescript" data-trim data-noescape>
        const { data, loading, error } = <mark>useItemByIdQuery</mark>({
            variables: { id: 1 }
        });

        if(loading) {
            return &lt;Loader /&gt;
        } else if(error) {
            return &lt;Apology /&gt;
        } else if(data) {
            const { item: { id, name } } = data;
            // ...
        }
	</code></pre>
        </div>
    </div>
    <aside class="notes">
        TypeScript knows exactly which fields are queried.
    </aside>
</section>
<!--Angular-->
<section>
    <div class="container">
        <div style="flex: 4">
    <pre style="width: 100%;"><code class="hljs graphql" data-trim data-noescape>
    query <mark>ItemById</mark> ($id: Int!) {
      item(id: $id){
        id
        name
      }
    }
	</code></pre>
        </div>
        <div style="flex: 2">

            <img src="https://graphql-code-generator.com/img/gql-codegen-cover.png" alt="codegen" width="200"/>
        </div>
        <div style="flex: 2; padding-right: 2em">

            <img src="https://angular.io/assets/images/logos/angular/angular.svg" alt="angular" style="width: 160px"/>
        </div>
    </div>
    <div class="container">
        <div style="flex: 8;" class="container__content">
    <pre style="width: 100%;"><code class="hljs typescript" data-trim data-noescape>
        constructor(private itemByIdGQL: <mark>ItemByIdGQL</mark>) {

        ngOnInit() {
            this.itemByIdSubscription = this.itemByIdGQL
                .watch({ id: 1 })
                .valueChanges
                .subscribe(({ data, loading, error }) => {
                    this.loading = loading;
                    this.item = data ? data.item : undefined;
                    this.error = error;
                });
        }
        // ..
	</code></pre>
        </div>
    </div>
    <aside class="notes">
        TypeScript knows exactly which fields are queried.
    </aside>
</section>

<section>
    <h2>REACT EXAMPLE</h2>
</section>

<section>
    <h2>Caching</h2>
</section>
<section>
    <h2>Fetch policies</h2>
    <div style="display:flex; align-items: center">
        <div>
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a7/React-icon.svg/1920px-React-icon.svg.png"
                 alt="react"/>
        </div>
        <pre style="width: 100%;"><code class="hljs typescript" data-trim data-noescape>
        const { data, loading, error } = useItemByIdQuery({
            variables: { id: 1 },
            fetchPolicy: 'cache-first', // (default)
            // cache-and-network
            // network-only
            // cache-only
            // no-cache
        });
	</code></pre>
    </div>
</section>
<section>
    <h2>Stale data</h2>
    <div style="display:flex; align-items: center">
        <div>
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a7/React-icon.svg/1920px-React-icon.svg.png"
                 alt="react"/>
        </div>
        <pre style="width: 100%;"><code class="hljs typescript" data-trim data-noescape>
        const [createItem, { data, ... }] = useCreateItemMutation();

        await createItem({
            variables: {
                // ...
            },
            refetchQueries: [
                "AllItems",
                // {
                //     query: AllItemsDocument
                // }
            ],
            awaitRefetchQueries: true
        })
	</code></pre>
    </div>
</section>

<section>

    <h2>Local state</h2>
</section>
<section>
    <div style="display: flex">
    <pre style="width: 100%; font-size: .5em;"><code class="hljs graphql" data-noescape>type Query {
    selectedItems: [ID!]! @client
}

type Item {
    isSelected: Boolean! @client
}
</code></pre>
        <pre class="fragment" style="width: 100%; font-size: .5em;"><code class="hljs typescript" data-noescape>const cache = new InMemoryCache();
cache.writeData({
  data: {
    selectedItems: [],
  },
});
</code></pre>
    </div>

    <pre style="width: 100%; font-size: .5em" class="fragment"><code class="hljs typescript" style="overflow: hidden"
                                                                     data-noescape><span style="opacity: .4">const client = new ApolloClient({</span>
  cache,
  resolvers: {
    Item: {
      isSelected: ({ id }, _, { cache }) => {
        const { selectedItems } = cache.readQuery({
            query: gql`query GetCartItems { selectedItems @client }`
        });
        return selectedItems.includes(id);
      },
    },
  },<span style="opacity: .4">
});</span></code></pre>
</section>
